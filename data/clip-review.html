<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SoundField: Clip Review - Select Canonical Sounds</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 { color: #4fc3f7; margin-bottom: 10px; }
    .instructions {
      background: #16213e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #4fc3f7;
    }
    .species-group {
      background: #16213e;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .species-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    .species-code {
      font-size: 24px;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 8px;
      color: #000;
    }
    .species-name { font-size: 18px; color: #aaa; }
    .clip-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px;
      background: #1a1a2e;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .clip-row:hover { background: #222244; }
    .clip-row.selected {
      background: #1e3a1e;
      border: 2px solid #4caf50;
    }
    .clip-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .clip-id { font-family: monospace; color: #4fc3f7; }
    .clip-type {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 4px;
      display: inline-block;
      width: fit-content;
    }
    .clip-type.song { background: #2e7d32; color: #fff; }
    .clip-type.call { background: #f57c00; color: #fff; }
    audio { width: 250px; height: 36px; }
    .select-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }
    .select-btn.unselected {
      background: #333;
      color: #888;
    }
    .select-btn.selected {
      background: #4caf50;
      color: #fff;
    }
    .output-section {
      background: #16213e;
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
    }
    .output-section h2 { color: #4fc3f7; margin-top: 0; }
    #output {
      background: #1a1a2e;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre;
      overflow-x: auto;
    }
    .copy-btn {
      background: #4fc3f7;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }
    .copy-btn:hover { background: #81d4fa; }
  </style>
</head>
<body>
  <h1>SoundField: Select Canonical Sounds</h1>

  <div class="instructions">
    <strong>Instructions:</strong> Listen to each clip and select the ONE that sounds most "textbook" for each species.
    This will be the sound used in beginner Level 1. Other clips will be introduced in later levels.
  </div>

  <div id="clips-container"></div>

  <div class="output-section">
    <h2>Your Selections</h2>
    <div id="output">Select one clip per species...</div>
    <button class="copy-btn" onclick="copyOutput()">Copy JSON</button>
  </div>

  <script>
    const SPECIES_COLORS = {
      NOCA: '#E57373',
      BLJA: '#4FC3F7',
      CARW: '#81C784',
      AMCR: '#757575',
      TUTI: '#FFD54F',
    };

    const SPECIES_NAMES = {
      NOCA: 'Northern Cardinal',
      BLJA: 'Blue Jay',
      CARW: 'Carolina Wren',
      AMCR: 'American Crow',
      TUTI: 'Tufted Titmouse',
    };

    // Will be populated from clips.json
    let clips = [];
    let selections = {};

    async function loadClips() {
      const response = await fetch('clips.json');
      clips = await response.json();
      renderClips();
    }

    function renderClips() {
      const container = document.getElementById('clips-container');

      // Group by species
      const bySpecies = {};
      for (const clip of clips) {
        const code = clip.species_code;
        if (!bySpecies[code]) bySpecies[code] = [];
        bySpecies[code].push(clip);
      }

      // Render each species group
      const speciesOrder = ['NOCA', 'CARW', 'TUTI', 'BLJA', 'AMCR'];
      for (const code of speciesOrder) {
        const speciesClips = bySpecies[code] || [];
        if (speciesClips.length === 0) continue;

        const group = document.createElement('div');
        group.className = 'species-group';
        group.innerHTML = `
          <div class="species-header">
            <span class="species-code" style="background: ${SPECIES_COLORS[code]}">${code}</span>
            <span class="species-name">${SPECIES_NAMES[code]}</span>
          </div>
        `;

        for (const clip of speciesClips) {
          const row = document.createElement('div');
          row.className = 'clip-row';
          row.id = `row-${clip.clip_id}`;

          const typeClass = clip.vocalization_type === 'song' ? 'song' : 'call';

          row.innerHTML = `
            <div class="clip-info">
              <span class="clip-id">${clip.source_id}</span>
              <span class="clip-type ${typeClass}">${clip.vocalization_type}</span>
            </div>
            <audio controls src="clips/${clip.file_path.split('/').pop()}"></audio>
            <button class="select-btn unselected" onclick="selectClip('${code}', '${clip.source_id}', '${clip.clip_id}')">
              Select
            </button>
          `;

          group.appendChild(row);
        }

        container.appendChild(group);
      }
    }

    function selectClip(speciesCode, sourceId, clipId) {
      // Deselect previous for this species
      if (selections[speciesCode]) {
        const prevRow = document.getElementById(`row-${selections[speciesCode].clipId}`);
        if (prevRow) {
          prevRow.classList.remove('selected');
          prevRow.querySelector('.select-btn').className = 'select-btn unselected';
          prevRow.querySelector('.select-btn').textContent = 'Select';
        }
      }

      // Select new
      selections[speciesCode] = { sourceId, clipId };
      const row = document.getElementById(`row-${clipId}`);
      row.classList.add('selected');
      row.querySelector('.select-btn').className = 'select-btn selected';
      row.querySelector('.select-btn').textContent = 'Selected';

      updateOutput();
    }

    function updateOutput() {
      const output = document.getElementById('output');

      const canonical = {};
      for (const [code, data] of Object.entries(selections)) {
        canonical[code] = data.sourceId;
      }

      if (Object.keys(canonical).length === 0) {
        output.textContent = 'Select one clip per species...';
      } else {
        output.textContent = JSON.stringify(canonical, null, 2);
      }
    }

    function copyOutput() {
      const output = document.getElementById('output').textContent;
      navigator.clipboard.writeText(output).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy JSON', 2000);
      });
    }

    // Load on page load
    loadClips();
  </script>
</body>
</html>
